{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "MDZ",
  "scopeName": "source.mdz",
  "fileTypes": ["mdz"],
  "patterns": [
    { "include": "#frontmatter" },
    { "include": "#comment" },
    { "include": "#code-block" },
    { "include": "#heading" },
    { "include": "#block-if-for-while" },
    { "include": "#block-do" },
    { "include": "#keyword" },
    { "include": "#control-flow" },
    { "include": "#type-definition" },
    { "include": "#variable" },
    { "include": "#type" },
    { "include": "#reference" },
    { "include": "#string" },
    { "include": "#template" },
    { "include": "#semantic-marker" },
    { "include": "#number" },
    { "include": "#operator" },
    { "include": "#list-marker" }
  ],
  "repository": {
    "frontmatter": {
      "begin": "^---$",
      "end": "^---$",
      "name": "meta.frontmatter.mdz",
      "contentName": "source.yaml",
      "patterns": [
        { "include": "source.yaml" }
      ]
    },
    "heading": {
      "match": "^(#{1,6})\\s+(.+)$",
      "captures": {
        "1": { "name": "punctuation.definition.heading.mdz" },
        "2": { "name": "entity.name.section.mdz" }
      },
      "name": "markup.heading.mdz"
    },
    "comment": {
      "begin": "<!--",
      "end": "-->",
      "name": "comment.block.mdz"
    },
    "control-flow": {
      "patterns": [
        {
          "match": "^\\s*(ELSE\\s+IF|ELSE|IF|FOR|WHILE|DO|END|RETURN|BREAK|CONTINUE|ASYNC|AWAIT)\\b",
          "name": "keyword.control.mdz"
        },
        {
          "match": "^\\s*(DELEGATE|USE|EXECUTE|GOTO)\\b",
          "name": "keyword.control.mdz"
        },
        {
          "match": "\\b(THEN|IN|AND|OR|NOT|WITH|TO)\\b",
          "name": "keyword.operator.word.mdz"
        }
      ]
    },
    "block-if-for-while": {
      "begin": "^\\s*(IF|FOR|WHILE)\\b",
      "end": "^\\s*END\\b",
      "name": "meta.block.control.mdz",
      "beginCaptures": {
        "1": { "name": "keyword.control.mdz" }
      },
      "patterns": [
        { "include": "#block-do" },
        { "include": "#block-if-for-while" },
        { "include": "#control-flow" },
        { "include": "#type-definition" },
        { "include": "#variable" },
        { "include": "#type" },
        { "include": "#reference" },
        { "include": "#string" },
        { "include": "#template" },
        { "include": "#semantic-marker" },
        { "include": "#number" },
        { "include": "#operator" }
      ]
    },
    "block-do": {
      "begin": "^\\s*DO\\s*$",
      "end": "^\\s*END\\b",
      "name": "meta.block.do.mdz",
      "beginCaptures": {
        "0": { "name": "keyword.control.mdz" }
      },
      "patterns": [
        { "include": "#block-if-for-while" },
        { "include": "#control-flow" },
        { "include": "#type-definition" },
        { "include": "#variable" },
        { "include": "#type" },
        { "include": "#reference" },
        { "include": "#string" },
        { "include": "#template" },
        { "include": "#semantic-marker" },
        { "include": "#number" },
        { "include": "#operator" }
      ]
    },
    "type-definition": {
      "match": "^(\\s*)(\\$[A-Z][a-zA-Z0-9]*)\\s*(:)",
      "captures": {
        "2": { "name": "entity.name.type.definition.mdz" },
        "3": { "name": "keyword.operator.assignment.mdz" }
      }
    },
    "variable": {
      "patterns": [
        {
          "comment": "Inferred variable: $/name/",
          "match": "\\$/[^/\\n]+/",
          "name": "variable.other.inferred.mdz"
        },
        {
          "match": "\\$[a-z][a-zA-Z0-9-]*",
          "name": "variable.other.mdz"
        }
      ]
    },
    "type": {
      "match": "\\$[A-Z][a-zA-Z0-9]*",
      "name": "entity.name.type.mdz"
    },
    "reference": {
      "patterns": [
        {
          "comment": "Link reference: ~/path/to/file or ~/path/to/file#section",
          "match": "(~/)([a-z][a-z0-9/-]*)(#[a-z][a-z0-9-]*)?",
          "name": "meta.reference.link.mdz",
          "captures": {
            "1": { "name": "punctuation.definition.link.mdz" },
            "2": { "name": "entity.name.type.skill.mdz" },
            "3": { "name": "entity.name.type.section.mdz" }
          }
        },
        {
          "comment": "Standalone anchor reference: #section",
          "match": "(?<!~/)#[a-z][a-z0-9-]*",
          "name": "entity.name.type.section.mdz"
        }
      ]
    },
    "semantic-marker": {
      "patterns": [
        {
          "begin": "/(?=[^/\\n]+/)",
          "end": "/",
          "name": "string.interpolated.semantic.mdz",
          "patterns": [
            { "include": "#variable" }
          ]
        }
      ]
    },
    "string": {
      "match": "\"([^\"]*)\"",
      "name": "string.quoted.double.mdz"
    },
    "template": {
      "begin": "`",
      "end": "`",
      "name": "string.template.mdz",
      "patterns": [
        {
          "match": "\\$\\{[^}]*\\}",
          "name": "variable.other.interpolated.mdz"
        },
        { "include": "#variable" }
      ]
    },
    "number": {
      "match": "-?\\d+(\\.\\d+)?",
      "name": "constant.numeric.mdz"
    },
    "operator": {
      "patterns": [
        {
          "match": "=>",
          "name": "keyword.operator.arrow.mdz"
        },
        {
          "match": "!=|<=|>=|<|>|=",
          "name": "keyword.operator.comparison.mdz"
        },
        {
          "match": ":",
          "name": "keyword.operator.assignment.mdz"
        },
        {
          "match": "\\|",
          "name": "keyword.operator.type.union.mdz"
        },
        {
          "match": "<<",
          "name": "keyword.operator.push.mdz"
        },
        {
          "match": "\\.",
          "name": "keyword.operator.accessor.mdz"
        }
      ]
    },
    "code-block": {
      "begin": "^\\s*```(\\w*)$",
      "end": "^\\s*```$",
      "name": "markup.fenced_code.mdz",
      "beginCaptures": {
        "1": { "name": "variable.parameter.mdz" }
      },
      "contentName": "meta.embedded.block.mdz"
    },
    "list-marker": {
      "match": "^\\s*(-|\\d+\\.)\\s",
      "name": "punctuation.definition.list_item.mdz"
    }
  }
}
