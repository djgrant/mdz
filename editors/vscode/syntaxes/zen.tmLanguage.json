{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "Zen",
  "scopeName": "source.zen.md",
  "fileTypes": ["zen.md"],
  "patterns": [
    { "include": "#frontmatter" },
    { "include": "#heading" },
    { "include": "#control-flow" },
    { "include": "#semantic-marker" },
    { "include": "#reference" },
    { "include": "#variable" },
    { "include": "#type" },
    { "include": "#string" },
    { "include": "#template" },
    { "include": "#number" },
    { "include": "#operator" },
    { "include": "#comment" },
    { "include": "#code-block" }
  ],
  "repository": {
    "frontmatter": {
      "begin": "^---$",
      "end": "^---$",
      "name": "meta.frontmatter.zen",
      "contentName": "source.yaml",
      "patterns": [
        {
          "match": "^(\\w+):\\s*(.*)$",
          "captures": {
            "1": { "name": "entity.name.tag.yaml" },
            "2": { "name": "string.unquoted.yaml" }
          }
        },
        {
          "match": "^\\s+-\\s+(.+)$",
          "captures": {
            "1": { "name": "string.unquoted.yaml" }
          }
        }
      ]
    },
    "heading": {
      "match": "^(#{1,6})\\s+(.+)$",
      "captures": {
        "1": { "name": "punctuation.definition.heading.zen" },
        "2": { "name": "entity.name.section.zen" }
      },
      "name": "markup.heading.zen"
    },
    "control-flow": {
      "patterns": [
        {
          "match": "\\b(FOR\\s+EACH)\\b",
          "name": "keyword.control.foreach.zen"
        },
        {
          "match": "\\b(WHILE)\\b",
          "name": "keyword.control.while.zen"
        },
        {
          "match": "\\b(IF)\\b",
          "name": "keyword.control.if.zen"
        },
        {
          "match": "\\b(THEN)\\b",
          "name": "keyword.control.then.zen"
        },
        {
          "match": "\\b(ELSE)\\b",
          "name": "keyword.control.else.zen"
        },
        {
          "match": "\\b(IN)\\b",
          "name": "keyword.operator.in.zen"
        },
        {
          "match": "\\b(AND)\\b",
          "name": "keyword.operator.logical.and.zen"
        },
        {
          "match": "\\b(OR)\\b",
          "name": "keyword.operator.logical.or.zen"
        },
        {
          "match": "\\b(NOT)\\b",
          "name": "keyword.operator.logical.not.zen"
        },
        {
          "match": "\\b(WITH)\\b",
          "name": "keyword.other.with.zen"
        }
      ]
    },
    "semantic-marker": {
      "patterns": [
        {
          "comment": "Inferred variable: $/name/",
          "match": "\\$(/[^/]+/)",
          "name": "meta.semantic-marker.inferred.zen",
          "captures": {
            "0": { "name": "variable.other.inferred.zen" },
            "1": { "name": "string.interpolated.semantic.zen" }
          }
        },
        {
          "comment": "Semantic marker: /content/",
          "begin": "/(?=[^/\\n]+/)",
          "end": "/",
          "name": "meta.semantic-marker.zen",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.semantic.begin.zen" }
          },
          "endCaptures": {
            "0": { "name": "punctuation.definition.semantic.end.zen" }
          },
          "contentName": "string.interpolated.semantic.zen",
          "patterns": [
            { "include": "#variable" }
          ]
        }
      ]
    },
    "reference": {
      "patterns": [
        {
          "match": "\\[\\[([a-z][a-z0-9-]*)(#[a-z][a-z0-9-]*)?\\]\\]",
          "name": "meta.reference.skill.zen",
          "captures": {
            "0": { "name": "entity.name.type.reference.zen" },
            "1": { "name": "entity.name.type.skill.zen" },
            "2": { "name": "entity.name.type.section.zen" }
          }
        },
        {
          "match": "\\[\\[(#[a-z][a-z0-9-]*)\\]\\]",
          "name": "meta.reference.section.zen",
          "captures": {
            "0": { "name": "entity.name.type.reference.zen" },
            "1": { "name": "entity.name.type.section.zen" }
          }
        }
      ]
    },
    "variable": {
      "match": "\\$([a-z][a-zA-Z0-9-]*)",
      "name": "variable.other.zen",
      "captures": {
        "1": { "name": "variable.other.readwrite.zen" }
      }
    },
    "type": {
      "match": "\\$([A-Z][a-zA-Z0-9]*)",
      "name": "entity.name.type.zen",
      "captures": {
        "1": { "name": "entity.name.type.class.zen" }
      }
    },
    "string": {
      "match": "\"([^\"]*)\"",
      "name": "string.quoted.double.zen",
      "captures": {
        "1": { "name": "string.quoted.double.zen" }
      }
    },
    "template": {
      "begin": "`",
      "end": "`",
      "name": "string.template.zen",
      "patterns": [
        {
          "match": "\\$\\{[^}]*\\}",
          "name": "variable.other.interpolated.zen"
        },
        { "include": "#semantic-marker" }
      ]
    },
    "number": {
      "match": "-?\\d+(\\.\\d+)?",
      "name": "constant.numeric.zen"
    },
    "operator": {
      "patterns": [
        {
          "match": "=>",
          "name": "keyword.operator.arrow.zen"
        },
        {
          "match": "!=|<=|>=|<|>|=",
          "name": "keyword.operator.comparison.zen"
        },
        {
          "match": "\\|",
          "name": "keyword.operator.pipe.zen"
        }
      ]
    },
    "comment": {
      "match": "^>\\s*(.*)$",
      "name": "comment.line.blockquote.zen",
      "captures": {
        "1": { "name": "comment.block.zen" }
      }
    },
    "code-block": {
      "begin": "^```(\\w*)$",
      "end": "^```$",
      "name": "markup.fenced_code.zen",
      "beginCaptures": {
        "1": { "name": "entity.name.section.fenced.zen" }
      },
      "contentName": "meta.embedded.block.zen"
    }
  }
}
