import MdzCodeBlock from "@web2/components/MdzCodeBlock.astro";
import snippet_docs_snippets_composition_link_examples_mdz from "./snippets/composition/link-examples.mdz?raw";
import snippet_docs_snippets_composition_link_in_prose_mdz from "./snippets/composition/link-in-prose.mdz?raw";
import snippet_docs_snippets_composition_anchor_current_mdz from "./snippets/composition/anchor-current.mdz?raw";
import snippet_docs_snippets_composition_anchor_external_mdz from "./snippets/composition/anchor-external.mdz?raw";
import snippet_docs_snippets_composition_section_anchors_mdz from "./snippets/composition/section-anchors.mdz?raw";
import snippet_docs_snippets_composition_use_mdz from "./snippets/composition/use.mdz?raw";
import snippet_docs_snippets_composition_with_clause_mdz from "./snippets/composition/with-clause.mdz?raw";
import snippet_docs_snippets_composition_delegate_mdz from "./snippets/composition/delegate.mdz?raw";
import snippet_docs_snippets_composition_execute_mdz from "./snippets/composition/execute.mdz?raw";
import snippet_docs_snippets_composition_goto_mdz from "./snippets/composition/goto.mdz?raw";
import snippet_docs_snippets_composition_pattern_delegate_mdz from "./snippets/composition/pattern-delegate.mdz?raw";
import snippet_docs_snippets_composition_pattern_conditional_mdz from "./snippets/composition/pattern-conditional.mdz?raw";
import snippet_docs_snippets_composition_pattern_iterative_mdz from "./snippets/composition/pattern-iterative.mdz?raw";

# Composition

Skills in MDZ compose through links and delegation, enabling complex behaviors from simple, validated components.

## Links

Links reference other files using path syntax:

<MdzCodeBlock source={snippet_docs_snippets_composition_link_examples_mdz} />

In prose:

<MdzCodeBlock source={snippet_docs_snippets_composition_link_in_prose_mdz} />

Tooling validates that linked files exist. You won't discover a missing dependency at runtime.

## Anchor References

### Within Current Skill

Use `#` to reference a section in the current document:

<MdzCodeBlock source={snippet_docs_snippets_composition_anchor_current_mdz} />

### In Another Skill

Combine links and anchors:

<MdzCodeBlock source={snippet_docs_snippets_composition_anchor_external_mdz} />

### Section Names

Section names are derived from headings by:

1. Converting to lowercase
2. Replacing spaces with hyphens
3. Removing special characters

<MdzCodeBlock source={snippet_docs_snippets_composition_section_anchors_mdz} />

## Skill Invocation with USE

Invoke a skill to perform a task using the **USE** keyword:

<MdzCodeBlock source={snippet_docs_snippets_composition_use_mdz} />

Tooling validates that the linked skill exists.

### Passing Templates with WITH

Pass a section template when invoking a skill:

<MdzCodeBlock source={snippet_docs_snippets_composition_with_clause_mdz} />

The WITH clause passes an anchor to the invoked skill as a template parameter.

## Folder Conventions

MDZ uses folder conventions to determine reference types:

- `agent/` -- Agents for delegation (autonomous subagents)
- `skill/` -- Reusable skill modules
- `tool/` -- External tool integrations

This replaces the old sigil-based syntax. The type is now inferred from the path.

### Benefits

- Dependency graph visualization
- Circular dependency detection
- IDE autocomplete for available files
- Clear file organization

## Agent Delegation with DELEGATE

For orchestrating autonomous subagents, use the **DELEGATE** keyword with an agent link:

<MdzCodeBlock source={snippet_docs_snippets_composition_delegate_mdz} />

## Tool Execution with EXECUTE

For executing external tools, use the **EXECUTE** keyword:

<MdzCodeBlock source={snippet_docs_snippets_composition_execute_mdz} />

## GOTO for Section Navigation

Jump to a section anchor using **GOTO**:

<MdzCodeBlock source={snippet_docs_snippets_composition_goto_mdz} />

## Keyword Summary

- **USE** -- Invoke skills for reusable workflows
- **EXECUTE** -- Run tools for external actions
- **DELEGATE** -- Spawn autonomous agents
- **GOTO** -- Jump to section anchors
- **WITH** -- Pass template sections

## Patterns

### Sub-Agent Delegation

<MdzCodeBlock source={snippet_docs_snippets_composition_pattern_delegate_mdz} />

### Conditional Execution

<MdzCodeBlock source={snippet_docs_snippets_composition_pattern_conditional_mdz} />

### Iterative Composition

<MdzCodeBlock source={snippet_docs_snippets_composition_pattern_iterative_mdz} />

## Link Handling

By default, links stay as-is--the LLM interprets `~/skill/name` syntax directly. With optional preprocessing:

- **Inlining** -- Referenced skill content embedded inline
- **Section extraction** -- Only the referenced section included

Both approaches are valid. Inlining reduces LLM load-time; leaving links keeps the prompt concise. Experiment to find what works best for your use case.

## Best Practices

- Use consistent folder organization (`agent/`, `skill/`, `tool/`)
- Create reusable prompt sections within skills
- Use descriptive section names
- Keep skills focused and composable
- Document expected parameters in Input sections
