import MdzCodeBlock from "@web2/components/MdzCodeBlock.astro";
import snippet_docs_snippets_control_flow_for_loop_mdz from "./snippets/control-flow/for-loop.mdz?raw";
import snippet_docs_snippets_control_flow_for_loop_destructuring_mdz from "./snippets/control-flow/for-loop-destructuring.mdz?raw";
import snippet_docs_snippets_control_flow_async_delegate_mdz from "./snippets/control-flow/async-delegate.mdz?raw";
import snippet_docs_snippets_control_flow_while_loop_mdz from "./snippets/control-flow/while-loop.mdz?raw";
import snippet_docs_snippets_control_flow_conditional_mdz from "./snippets/control-flow/conditional.mdz?raw";
import snippet_docs_snippets_control_flow_multiline_conditional_mdz from "./snippets/control-flow/multiline-conditional.mdz?raw";
import snippet_docs_snippets_control_flow_nesting_mdz from "./snippets/control-flow/nesting.mdz?raw";
import snippet_docs_snippets_control_flow_break_continue_mdz from "./snippets/control-flow/break-continue.mdz?raw";
import snippet_docs_snippets_control_flow_semantic_conditions_mdz from "./snippets/control-flow/semantic-conditions.mdz?raw";
import snippet_docs_snippets_control_flow_delegate_mdz from "./snippets/control-flow/delegate.mdz?raw";
import snippet_docs_snippets_control_flow_use_mdz from "./snippets/control-flow/use.mdz?raw";
import snippet_docs_snippets_control_flow_execute_mdz from "./snippets/control-flow/execute.mdz?raw";
import snippet_docs_snippets_control_flow_goto_mdz from "./snippets/control-flow/goto.mdz?raw";

# Control Flow

MDZ uses CAPS keywords for control flow to visually distinguish executable structure from prose content.

## For Loop

Iterate over a collection using the **collection operator** (`IN`):

<MdzCodeBlock source={snippet_docs_snippets_control_flow_for_loop_mdz} />

### With Destructuring

Unpack **tuples** during iteration using **destructuring**:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_for_loop_destructuring_mdz} />

### Asynchronous Delegation

For parallel execution, use `ASYNC DELEGATE` inside a loop:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_async_delegate_mdz} />

Use ASYNC DELEGATE when:

- Iterations are independent
- Order doesn't matter
- Maximum throughput is desired

## While Loop

Loop with a **condition**. The `DO` keyword delimits the condition (like `THEN` for `IF`):

<MdzCodeBlock source={snippet_docs_snippets_control_flow_while_loop_mdz} />

### Condition Types

Conditions can be:

- **Deterministic condition**: `$x < 5`, `$status = "active"`
- **Semantic condition**: `NOT diminishing returns` (LLM interprets)
- **Combined**: `NOT complete AND $count < 10` (using **logical operators**)

## Conditional

Branch with `IF`/`THEN` and optional **else clause**:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_conditional_mdz} />

### Multi-line Branches

<MdzCodeBlock source={snippet_docs_snippets_control_flow_multiline_conditional_mdz} />

### Comparison Operators

- `=` -- equality
- `!=` -- inequality
- `<`, `>` -- less than, greater than
- `<=`, `>=` -- less/greater than or equal

### Logical Operators

Use **logical operators** to combine conditions:

- `AND` -- both conditions must be true
- `OR` -- either condition can be true
- `NOT` -- negates a condition

## Nesting

Control flow can be nested. Blocks are closed with `END`:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_nesting_mdz} />

## Break and Continue

Use `BREAK` and `CONTINUE` for early exit and skip within loops:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_break_continue_mdz} />

BREAK and CONTINUE are valid in:

- FOR loops
- WHILE loops

They are **not** valid outside of loops (parser error).

## Semantic Conditions

**Semantic conditions** are natural language expressions that the LLM interprets. Use them when the condition requires understanding context:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_semantic_conditions_mdz} />

## Composition Keywords

MDZ provides several keywords for composition:

### DELEGATE (Agent Delegation)

Use **DELEGATE** to spawn autonomous subagent tasks:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_delegate_mdz} />

### USE (Skill Invocation)

Use **USE** to invoke a skill:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_use_mdz} />

### EXECUTE (Tool Execution)

Use **EXECUTE** to run an external tool:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_execute_mdz} />

### GOTO (Section Navigation)

Use **GOTO** to jump to a section anchor:

<MdzCodeBlock source={snippet_docs_snippets_control_flow_goto_mdz} />

See [Composition](/docs/composition) for more details on these keywords.

## Design Philosophy

- **CAPS Keywords** -- Visually distinct from prose
- **Explicit Termination** -- Always include bounds to prevent infinite loops
- **Mixed Conditions** -- Combine deterministic checks with semantic interpretation
- **Clear Indentation** -- Structure is visible at a glance
- **ASYNC DELEGATE** -- Enables concurrent execution
- **BREAK/CONTINUE** -- Enable early exit from loops
- **USE/EXECUTE/DELEGATE/GOTO** -- Composition keywords
