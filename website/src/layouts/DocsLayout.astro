---
import Layout from './Layout.astro';
import Header from '../components/Header.astro';

interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
const currentPath = Astro.url.pathname;

const sections = [
   {
     title: 'Getting Started',
     links: [
       { href: '/docs', label: 'Overview' },
       { href: '/docs/getting-started', label: 'Quick Start' },
       { href: '/docs/using-in-project', label: 'Using in Project' },
       { href: '/docs/concepts', label: 'Core Concepts' },
     ]
   },
   {
     title: 'Language',
     links: [
       { href: '/docs/syntax', label: 'Syntax Reference' },
       { href: '/docs/types', label: 'Type System' },
       { href: '/docs/control-flow', label: 'Control Flow' },
       { href: '/docs/composition', label: 'Composition' },
       { href: '/docs/higher-order', label: 'Higher-Order Skills' },
     ]
   },
   {
     title: 'Internals',
     links: [
       { href: '/docs/internals', label: 'Overview' },
       { href: '/docs/internals/ast', label: 'AST Structure' },
       { href: '/docs/internals/compilation', label: 'Compilation' },
       { href: '/docs/internals/validation', label: 'Validation' },
       { href: '/docs/internals/terminology', label: 'Terminology' },
     ]
   },
  {
    title: 'Tools',
    links: [
      { href: '/docs/cli', label: 'CLI' },
      { href: '/docs/api', label: 'API' },
      { href: '/docs/ide', label: 'IDE Support' },
    ]
  },
];

// Find current page label for mobile nav button
const currentPageLabel = sections
  .flatMap(s => s.links)
  .find(link => link.href === currentPath)?.label ?? 'Navigation';
---

<Layout title={`${title} - MDZ docs`} description={description}>
  <Header currentPath="/docs" />
  
  <div class="max-w-[var(--max-width-content)] mx-auto px-[var(--spacing-page)] py-12">
    <div class="flex gap-4 lg:gap-16">
      <!-- Desktop Sidebar -->
      <aside class="hidden lg:block w-56 flex-shrink-0">
        <nav class="sticky top-24 space-y-8">
          {sections.map(section => (
            <div>
              <h4 class="nav-section-heading">
                {section.title}
              </h4>
              <ul class="space-y-1">
                {section.links.map(link => (
                  <li>
                    <a 
                      href={link.href}
                      class:list={[
                        'block py-2 px-3 text-sm rounded-md transition-colors',
                        currentPath === link.href
                          ? 'bg-[var(--color-accent)]/10 text-[var(--color-accent)] font-medium'
                          : 'text-[var(--color-muted)] dark:text-[var(--color-muted-dark)] hover:text-[var(--color-text)] dark:hover:text-[var(--color-text-dark)] hover:bg-black/5 dark:hover:bg-white/5'
                      ]}
                    >
                      {link.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))}
        </nav>
      </aside>
      
      <!-- Content -->
      <main class="flex-1 min-w-0 max-w-[var(--max-width-prose)]">
        <!-- Mobile Navigation -->
        <div class="lg:hidden mb-6">
          <button
            id="mobile-nav-toggle"
            class="mobile-nav-toggle"
            aria-expanded="false"
            aria-controls="mobile-nav-menu"
          >
            <span class="mobile-nav-current">{currentPageLabel}</span>
            <svg
              class="mobile-nav-chevron"
              width="20"
              height="20"
              viewBox="0 0 20 20"
              fill="none"
              aria-hidden="true"
            >
              <path
                d="M5 7.5L10 12.5L15 7.5"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
          
          <nav
            id="mobile-nav-menu"
            class="mobile-nav-menu"
            aria-label="Documentation navigation"
          >
            {sections.map(section => (
              <div class="mobile-nav-section">
                <h4 class="nav-section-heading">
                  {section.title}
                </h4>
                <ul class="space-y-1">
                  {section.links.map(link => (
                    <li>
                      <a 
                        href={link.href}
                        class:list={[
                          'block py-2 px-3 text-sm rounded-md transition-colors',
                          currentPath === link.href
                            ? 'bg-[var(--color-accent)]/10 text-[var(--color-accent)] font-medium'
                            : 'text-[var(--color-muted)] dark:text-[var(--color-muted-dark)] hover:text-[var(--color-text)] dark:hover:text-[var(--color-text-dark)] hover:bg-black/5 dark:hover:bg-white/5'
                        ]}
                      >
                        {link.label}
                      </a>
                    </li>
                  ))}
                </ul>
              </div>
            ))}
          </nav>
        </div>

        <article class="docs-content">
          <slot />
        </article>
      </main>
    </div>
  </div>
</Layout>

<script>
  const toggle = document.getElementById('mobile-nav-toggle');
  const menu = document.getElementById('mobile-nav-menu');
  
  if (toggle && menu) {
    toggle.addEventListener('click', () => {
      const isExpanded = toggle.getAttribute('aria-expanded') === 'true';
      toggle.setAttribute('aria-expanded', String(!isExpanded));
      menu.classList.toggle('is-open');
    });
    
    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
      if (!toggle.contains(e.target as Node) && !menu.contains(e.target as Node)) {
        toggle.setAttribute('aria-expanded', 'false');
        menu.classList.remove('is-open');
      }
    });
    
    // Close menu on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        toggle.setAttribute('aria-expanded', 'false');
        menu.classList.remove('is-open');
        toggle.focus();
      }
    });
  }
</script>

<style>
  /* Mobile Navigation Toggle */
  .mobile-nav-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.75rem 1rem;
    background: var(--color-bg);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--color-text);
    cursor: pointer;
    transition: border-color 0.15s ease, box-shadow 0.15s ease;
  }
  
  .mobile-nav-toggle:hover {
    border-color: var(--color-accent);
  }
  
  .mobile-nav-toggle:focus-visible {
    outline: none;
    border-color: var(--color-accent);
    box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-accent) 20%, transparent);
  }
  
  .mobile-nav-toggle[aria-expanded="true"] {
    border-color: var(--color-accent);
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom-color: transparent;
  }
  
  @media (prefers-color-scheme: dark) {
    .mobile-nav-toggle {
      background: var(--color-bg-dark);
      border-color: var(--color-border-dark);
      color: var(--color-text-dark);
    }
    
    .mobile-nav-toggle[aria-expanded="true"] {
      border-bottom-color: transparent;
    }
  }
  
  .mobile-nav-current {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .mobile-nav-chevron {
    flex-shrink: 0;
    margin-left: 0.5rem;
    color: var(--color-muted);
    transition: transform 0.2s ease;
  }
  
  .mobile-nav-toggle[aria-expanded="true"] .mobile-nav-chevron {
    transform: rotate(180deg);
  }
  
  @media (prefers-color-scheme: dark) {
    .mobile-nav-chevron {
      color: var(--color-muted-dark);
    }
  }
  
  /* Mobile Navigation Menu */
  .mobile-nav-menu {
    display: grid;
    grid-template-rows: 0fr;
    opacity: 0;
    visibility: hidden;
    background: var(--color-bg);
    border: 1px solid transparent;
    border-top: none;
    border-bottom-left-radius: 0.5rem;
    border-bottom-right-radius: 0.5rem;
    transition: grid-template-rows 0.25s ease, opacity 0.2s ease, visibility 0.2s ease, border-color 0.2s ease;
    overflow: hidden;
  }
  
  .mobile-nav-menu.is-open {
    grid-template-rows: 1fr;
    opacity: 1;
    visibility: visible;
    border-color: var(--color-accent);
  }
  
  @media (prefers-color-scheme: dark) {
    .mobile-nav-menu {
      background: var(--color-bg-dark);
    }
  }
  
  .mobile-nav-section {
    padding: 1rem 1rem 0.5rem;
  }
  
  .mobile-nav-section:first-child {
    padding-top: 0.75rem;
  }
  
  .mobile-nav-section:last-child {
    padding-bottom: 1rem;
  }
  
  /* Navigation section headings */
  .nav-section-heading {
    font-size: 0.85rem;
    line-height: 1;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-muted);
    margin-bottom: 1rem;
  }
  
  @media (prefers-color-scheme: dark) {
    .nav-section-heading {
      color: var(--color-muted-dark);
    }
  }

  /* Documentation typography */
  .docs-content {
    color: var(--color-text);
    line-height: 1.75;
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content {
      color: var(--color-text-dark);
    }
  }
  
  /* Headings */
  .docs-content :global(h1) {
    font-size: 2.25rem;
    font-weight: 600;
    letter-spacing: -0.025em;
    margin-bottom: 1.5rem;
    color: var(--color-text);
  }
  
  .docs-content :global(h2) {
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: -0.025em;
    margin-top: 3rem;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--color-border);
    color: var(--color-text);
  }
  
  .docs-content :global(h3) {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: var(--color-text);
  }
  
  .docs-content :global(h4) {
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(h1),
    .docs-content :global(h2),
    .docs-content :global(h3),
    .docs-content :global(h4) {
      color: var(--color-text-dark);
    }
    .docs-content :global(h2) {
      border-bottom-color: var(--color-border-dark);
    }
  }
  
  /* Paragraphs and lead text */
  .docs-content :global(p) {
    margin-bottom: 1.25rem;
  }
  
  .docs-content :global(p.lead),
  .docs-content :global(> p:first-of-type) {
    font-size: 1.125rem;
    color: var(--color-muted);
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(p.lead),
    .docs-content :global(> p:first-of-type) {
      color: var(--color-muted-dark);
    }
  }
  
  /* Links */
  .docs-content :global(a) {
    color: var(--color-accent);
    text-decoration: none;
    font-weight: 500;
  }
  
  .docs-content :global(a:hover) {
    text-decoration: underline;
  }
  
  /* Lists - tightened spacing */
  .docs-content :global(ul),
  .docs-content :global(ol) {
    margin-bottom: 1.25rem;
    padding-left: 1.5rem;
  }
  
  .docs-content :global(ul) {
    list-style-type: disc;
  }
  
  .docs-content :global(ol) {
    list-style-type: decimal;
  }
  
  .docs-content :global(li) {
    margin-bottom: 0.25rem;
    padding-left: 0.25rem;
  }
  
  .docs-content :global(li > ul),
  .docs-content :global(li > ol) {
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
  }
  
  /* Code blocks with syntax highlighting */
  .docs-content :global(pre) {
    background: #1a1a1a;
    color: #e5e5e5;
    padding: 1.25rem 1.5rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.75rem 0;
    font-size: 0.875rem;
    line-height: 1.7;
  }
  
  .docs-content :global(pre code) {
    background: none !important;
    padding: 0 !important;
    font-size: inherit !important;
    color: inherit !important;
  }
  
  /* Syntax highlighting classes in docs - use !important to override Prism */
  .docs-content :global(.zen-keyword) { color: var(--color-keyword) !important; font-weight: 600 !important; }
  .docs-content :global(.zen-type) { color: var(--color-type) !important; }
  .docs-content :global(.zen-variable) { color: var(--color-variable) !important; }
  .docs-content :global(.zen-string) { color: var(--color-string) !important; }
  .docs-content :global(.zen-semantic) { color: var(--color-semantic) !important; font-style: italic !important; }
  .docs-content :global(.zen-reference) { color: var(--color-reference) !important; }
  .docs-content :global(.zen-comment) { color: #6A737D !important; font-style: italic !important; }
  .docs-content :global(.zen-heading) { color: #E5E5E5 !important; font-weight: bold !important; }
  
  /* Inline code */
  .docs-content :global(code) {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background: color-mix(in srgb, var(--color-accent) 10%, transparent);
    color: var(--color-accent);
    padding: 0.2em 0.4em;
    border-radius: 0.25rem;
  }
  
  /* Strong text */
  .docs-content :global(strong) {
    font-weight: 600;
    color: var(--color-text);
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(strong) {
      color: var(--color-text-dark);
    }
  }
  
  /* Blockquotes */
  .docs-content :global(blockquote) {
    border-left: 3px solid var(--color-accent);
    padding-left: 1rem;
    margin: 1.5rem 0;
    font-style: italic;
    color: var(--color-muted);
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(blockquote) {
      color: var(--color-muted-dark);
    }
  }
  
  /* Horizontal rules */
  .docs-content :global(hr) {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: 3rem 0;
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(hr) {
      border-top-color: var(--color-border-dark);
    }
  }
  
  /* Tables - with overflow handling for mobile */
  .docs-content :global(table) {
    display: block;
    width: 100%;
    overflow-x: auto;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 0.875rem;
  }
  
  .docs-content :global(th),
  .docs-content :global(td) {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
    white-space: nowrap;
  }
  
  .docs-content :global(th) {
    font-weight: 600;
    background: color-mix(in srgb, var(--color-border) 30%, transparent);
  }
  
  @media (prefers-color-scheme: dark) {
    .docs-content :global(th),
    .docs-content :global(td) {
      border-bottom-color: var(--color-border-dark);
    }
    .docs-content :global(th) {
      background: color-mix(in srgb, var(--color-border-dark) 30%, transparent);
    }
  }
</style>

<!-- Prism.js removed - was stripping MDZ syntax highlighting in Firefox -->
