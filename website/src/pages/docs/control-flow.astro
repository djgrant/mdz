---
import DocsLayout from '../../layouts/DocsLayout.astro';
---

<DocsLayout title="Control Flow">
  <h1>Control Flow</h1>
  
  <p class="lead">
    MDZ uses CAPS keywords for control flow to visually distinguish executable 
    structure from prose content.
  </p>

  <h2>For-Each Loop</h2>
  
  <p>Iterate over a collection using the <strong>collection operator</strong> (<code>IN</code>):</p>
  
  <pre><code class="mdz"><span class="zen-keyword">FOR EACH</span> <span class="zen-variable">$item</span> <span class="zen-keyword">IN</span> <span class="zen-variable">$collection</span>:
  - Process <span class="zen-variable">$item</span>
  - Next step</code></pre>

  <h3>With Destructuring</h3>
  
  <p>Unpack <strong>tuples</strong> during iteration using <strong>destructuring</strong>:</p>
  
  <pre><code class="mdz"><span class="zen-keyword">FOR EACH</span> (<span class="zen-variable">$task</span>, <span class="zen-variable">$priority</span>) <span class="zen-keyword">IN</span> <span class="zen-variable">$items</span>:
  - Execute <span class="zen-variable">$task</span>
  - <span class="zen-keyword">IF</span> <span class="zen-variable">$priority</span> = <span class="zen-string">"high"</span> <span class="zen-keyword">THEN</span>:
    - Expedite processing</code></pre>

  <h2>Parallel For-Each Loop</h2>
  
  <p>Iterate with concurrent execution using <code>PARALLEL FOR EACH</code>:</p>
  
  <pre><code class="mdz"><span class="zen-keyword">PARALLEL FOR EACH</span> <span class="zen-variable">$item</span> <span class="zen-keyword">IN</span> <span class="zen-variable">$items</span>:
  - Process <span class="zen-variable">$item</span> independently
  - Results collected when all complete</code></pre>

  <p>Use PARALLEL FOR EACH when:</p>
  
  <ul>
    <li>Iterations are independent</li>
    <li>Order doesn't matter</li>
    <li>Maximum throughput is desired</li>
  </ul>

  <h2>While Loop</h2>
  
  <p>Loop with a <strong>condition</strong>. The <code>DO</code> keyword delimits the condition (like <code>THEN</code> for <code>IF</code>):</p>
  
  <pre><code class="mdz"><span class="zen-keyword">WHILE</span> condition <span class="zen-keyword">AND</span> <span class="zen-variable">$iterations</span> &lt; 5 <span class="zen-keyword">DO</span>:
  - Perform iteration
  - Update state</code></pre>

  <h3>Condition Types</h3>
  
  <p>Conditions can be:</p>
  
  <ul>
    <li><strong>Deterministic condition</strong>: <code>$x &lt; 5</code>, <code>$status = "active"</code></li>
    <li><strong>Semantic condition</strong>: <code>NOT diminishing returns</code> (LLM interprets)</li>
    <li><strong>Combined</strong>: <code>NOT complete AND $count &lt; 10</code> (using <strong>logical operators</strong>)</li>
  </ul>

  <h2>Conditional</h2>
  
  <p>Branch with <code>IF</code>/<code>THEN</code> and optional <strong>else clause</strong>:</p>
  
  <pre><code class="mdz"><span class="zen-keyword">IF</span> <span class="zen-variable">$condition</span> <span class="zen-keyword">THEN</span>:
  - Do this
<span class="zen-keyword">ELSE</span>:
  - Do that</code></pre>

  <h3>Multi-line Branches</h3>
  
  <pre><code class="mdz"><span class="zen-keyword">IF</span> <span class="zen-variable">$strategy</span> = <span class="zen-string">"accumulate"</span> <span class="zen-keyword">THEN</span>:
  - Validate incrementally
  - Update on success
  - Log progress
<span class="zen-keyword">ELSE</span>:
  - Collect all candidates
  - Validate at end
  - Report summary</code></pre>

  <h3>Comparison Operators</h3>
  
  <ul>
    <li><code>=</code> — equality</li>
    <li><code>!=</code> — inequality</li>
    <li><code>&lt;</code>, <code>&gt;</code> — less than, greater than</li>
    <li><code>&lt;=</code>, <code>&gt;=</code> — less/greater than or equal</li>
  </ul>

  <h3>Logical Operators</h3>
  
  <p>Use <strong>logical operators</strong> to combine conditions:</p>
  
  <ul>
    <li><code>AND</code> — both conditions must be true</li>
    <li><code>OR</code> — either condition can be true</li>
    <li><code>NOT</code> — negates a condition</li>
  </ul>

  <h2>Nesting</h2>
  
  <p>Control flow can be nested. Indentation defines the <strong>block</strong>:</p>
  
  <pre><code class="mdz"><span class="zen-keyword">FOR EACH</span> <span class="zen-variable">$task</span> <span class="zen-keyword">IN</span> <span class="zen-variable">$tasks</span>:
  - Process <span class="zen-variable">$task</span>
  - <span class="zen-keyword">IF</span> <span class="zen-variable">$task</span>.priority = <span class="zen-string">"high"</span> <span class="zen-keyword">THEN</span>:
    - <span class="zen-keyword">WHILE</span> <span class="zen-keyword">NOT</span> complete <span class="zen-keyword">DO</span>:
      - Execute step
      - Check progress
    - Log completion
  - Move to next task</code></pre></invoke>

  <h2>Break and Continue</h2>
  
  <p>Use <code>BREAK</code> and <code>CONTINUE</code> for early exit and skip within loops:</p>
  
  <pre><code class="mdz"><span class="zen-keyword">FOR EACH</span> <span class="zen-variable">$item</span> <span class="zen-keyword">IN</span> <span class="zen-variable">$items</span>:
  - <span class="zen-keyword">IF</span> <span class="zen-variable">$item</span>.invalid <span class="zen-keyword">THEN</span>:
    - <span class="zen-keyword">CONTINUE</span>              <span class="zen-comment"># Skip to next iteration</span>
  - <span class="zen-keyword">IF</span> <span class="zen-variable">$found</span> = true <span class="zen-keyword">THEN</span>:
    - <span class="zen-keyword">BREAK</span>                 <span class="zen-comment"># Exit the loop</span>
  - Process normally</code></pre>

  <p>BREAK and CONTINUE are valid in:</p>
  
  <ul>
    <li>FOR EACH loops</li>
    <li>PARALLEL FOR EACH loops</li>
    <li>WHILE loops</li>
  </ul>
  
  <p>They are <strong>not</strong> valid outside of loops (parser error).</p>

  <h2>Semantic Conditions</h2>
  
  <p>
    <strong>Semantic conditions</strong> are natural language expressions that the LLM 
    interprets. Use them when the condition requires understanding context:
  </p>
  
  <pre><code class="mdz"><span class="zen-keyword">WHILE</span> <span class="zen-keyword">NOT</span> diminishing returns <span class="zen-keyword">DO</span>:
  - Continue iterating

<span class="zen-keyword">IF</span> the result looks promising <span class="zen-keyword">THEN</span>:
  - Proceed with optimization</code></pre>

  <h2>Composition Keywords</h2>
  
  <p>
    MDZ provides several keywords for composition:
  </p>

  <h3>DELEGATE (Agent Delegation)</h3>
  
  <p>
    Use <strong>DELEGATE</strong> to spawn autonomous subagent tasks:
  </p>
  
  <pre><code class="mdz"><span class="zen-keyword">DELEGATE</span> <span class="zen-semantic">/initial research/</span> <span class="zen-keyword">TO</span> <span class="zen-reference">~/agent/explorer</span></code></pre>

  <h3>USE (Skill Invocation)</h3>
  
  <p>
    Use <strong>USE</strong> to invoke a skill:
  </p>
  
  <pre><code class="mdz"><span class="zen-keyword">USE</span> <span class="zen-reference">~/skill/orchestrate</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/coordinate the workflow/</span></code></pre>

  <h3>EXECUTE (Tool Execution)</h3>
  
  <p>
    Use <strong>EXECUTE</strong> to run an external tool:
  </p>
  
  <pre><code class="mdz"><span class="zen-keyword">EXECUTE</span> <span class="zen-reference">~/tool/browser</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/take screenshot/</span></code></pre>

  <h3>GOTO (Section Navigation)</h3>
  
  <p>
    Use <strong>GOTO</strong> to jump to a section anchor:
  </p>
  
  <pre><code class="mdz"><span class="zen-keyword">GOTO</span> <span class="zen-reference">#validation-prompt</span></code></pre>

  <p>
    See <a href="/docs/composition">Composition</a> for more details on these keywords.
  </p>

  <h2>Design Philosophy</h2>
  
  <ul>
    <li><strong>CAPS Keywords</strong> — Visually distinct from prose</li>
    <li><strong>Explicit Termination</strong> — Always include bounds to prevent infinite loops</li>
    <li><strong>Mixed Conditions</strong> — Combine deterministic checks with semantic interpretation</li>
    <li><strong>Clear Indentation</strong> — Structure is visible at a glance</li>
    <li><strong>PARALLEL</strong> — Enables concurrent execution</li>
    <li><strong>BREAK/CONTINUE</strong> — Enable early exit from loops</li>
    <li><strong>USE/EXECUTE/DELEGATE/GOTO</strong> — Composition keywords</li>
  </ul>
</DocsLayout>
