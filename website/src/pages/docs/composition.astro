---
import DocsLayout from "../../layouts/DocsLayout.astro";
---

<DocsLayout title="Composition">
  <h1>Composition</h1>

  <p class="lead">
    Skills in MDZ compose through links and delegation, enabling complex
    behaviors from simple, validated components.
  </p>

  <h2>Links</h2>

  <p>Links reference other files using path syntax:</p>

  <pre><code class="mdz"><span class="zen-reference">~/skill/code-review</span>           <span class="zen-comment">&lt;!-- skill link --&gt;</span>
<span class="zen-reference">~/agent/architect</span>             <span class="zen-comment">&lt;!-- agent link --&gt;</span>
<span class="zen-reference">~/tool/browser</span>                <span class="zen-comment">&lt;!-- tool link --&gt;</span></code></pre>

  <p>In prose:</p>

  <pre><code>Apply the methodology from <span class="zen-reference">~/skill/orchestrate-map-reduce</span>.</code></pre>

  <p>
    Tooling validates that linked files exist. You won't discover a missing
    dependency at runtime.
  </p>

  <h2>Anchor References</h2>

  <h3>Within Current Skill</h3>

  <p>Use <code>#</code> to reference a section in the current document:</p>

  <pre><code class="mdz"><span class="zen-reference">#section-name</span></code></pre>

  <h3>In Another Skill</h3>

  <p>Combine links and anchors:</p>

  <pre><code class="mdz"><span class="zen-reference">~/skill/helper#section-name</span></code></pre>

  <h3>Section Names</h3>

  <p>Section names are derived from headings by:</p>

  <ol>
    <li>Converting to lowercase</li>
    <li>Replacing spaces with hyphens</li>
    <li>Removing special characters</li>
  </ol>

  <pre><code class="mdz"><span class="zen-heading">## Validate Prompt</span>
→ <span class="zen-reference">#validate-prompt</span>

<span class="zen-heading">## 2. Execute Phase</span>
→ <span class="zen-reference">#2-execute-phase</span></code></pre>

  <h2>Skill Invocation with USE</h2>

  <p>Invoke a skill to perform a task using the <strong>USE</strong> keyword:</p>

  <pre><code class="mdz"><span class="zen-keyword">USE</span> <span class="zen-reference">~/skill/code-review</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/check style and patterns/</span>

<span class="zen-keyword">USE</span> <span class="zen-reference">~/skill/orchestrate</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/coordinate the workflow/</span></code></pre>

  <p>
    Tooling validates that the linked skill exists.
  </p>

  <h3>Passing Templates with WITH</h3>

  <p>Pass a section template when invoking a skill:</p>

  <pre><code class="mdz"><span class="zen-keyword">USE</span> <span class="zen-reference">~/skill/mapper</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/process items/</span> <span class="zen-keyword">WITH</span> <span class="zen-reference">#item-prompt</span></code></pre>

  <p>
    The WITH clause passes an anchor to the invoked skill as a template parameter.
  </p>

  <h2>Folder Conventions</h2>

  <p>MDZ uses folder conventions to determine reference types:</p>

  <ul>
    <li><code>agent/</code> — Agents for delegation (autonomous subagents)</li>
    <li><code>skill/</code> — Reusable skill modules</li>
    <li><code>tool/</code> — External tool integrations</li>
  </ul>

  <p>
    This replaces the old sigil-based syntax. The type is now inferred from the path.
  </p>

  <h3>Benefits</h3>

  <ul>
    <li>Dependency graph visualization</li>
    <li>Circular dependency detection</li>
    <li>IDE autocomplete for available files</li>
    <li>Clear file organization</li>
  </ul>

  <h2>Agent Delegation with DELEGATE</h2>

  <p>For orchestrating autonomous subagents, use the <strong>DELEGATE</strong> keyword with an agent link:</p>

  <pre><code class="mdz"><span class="zen-keyword">DELEGATE</span> <span class="zen-semantic">/initial analysis/</span> <span class="zen-keyword">TO</span> <span class="zen-reference">~/agent/explorer</span>

<span class="zen-keyword">DELEGATE</span> <span class="zen-semantic">/architecture design/</span> <span class="zen-keyword">TO</span> <span class="zen-reference">~/agent/architect</span></code></pre>

  <h2>Tool Execution with EXECUTE</h2>

  <p>For executing external tools, use the <strong>EXECUTE</strong> keyword:</p>

  <pre><code class="mdz"><span class="zen-keyword">EXECUTE</span> <span class="zen-reference">~/tool/browser</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/take screenshot/</span>

<span class="zen-keyword">EXECUTE</span> <span class="zen-reference">~/tool/file-system</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/read configuration/</span></code></pre>

  <h2>GOTO for Section Navigation</h2>

  <p>Jump to a section anchor using <strong>GOTO</strong>:</p>

  <pre><code class="mdz"><span class="zen-keyword">GOTO</span> <span class="zen-reference">#validation-prompt</span>

<span class="zen-keyword">GOTO</span> <span class="zen-reference">~/skill/helper#setup</span></code></pre>

  <h2>Keyword Summary</h2>

  <ul>
    <li><strong>USE</strong> — Invoke skills for reusable workflows</li>
    <li><strong>EXECUTE</strong> — Run tools for external actions</li>
    <li><strong>DELEGATE</strong> — Spawn autonomous agents</li>
    <li><strong>GOTO</strong> — Jump to section anchors</li>
    <li><strong>WITH</strong> — Pass template sections</li>
  </ul>

  <h2>Patterns</h2>

  <h3>Sub-Agent Delegation</h3>

  <pre><code class="mdz"><span class="zen-keyword">DELEGATE</span> <span class="zen-semantic">/research phase/</span> <span class="zen-keyword">TO</span> <span class="zen-reference">~/agent/explorer</span>

<span class="zen-keyword">DELEGATE</span> <span class="zen-semantic">/design system/</span> <span class="zen-keyword">TO</span> <span class="zen-reference">~/agent/architect</span></code></pre>

  <h3>Conditional Execution</h3>

  <pre><code class="mdz"><span class="zen-keyword">IF</span> <span class="zen-variable">$result</span> = <span class="zen-string">"failure"</span> <span class="zen-keyword">THEN</span>:
  - <span class="zen-keyword">GOTO</span> <span class="zen-reference">#recovery-strategy</span>
<span class="zen-keyword">ELSE</span>:
  - <span class="zen-keyword">GOTO</span> <span class="zen-reference">#main-workflow</span></code></pre>

  <h3>Iterative Composition</h3>

  <pre><code class="mdz"><span class="zen-keyword">FOR EACH</span> <span class="zen-variable">$skill</span> <span class="zen-keyword">IN</span> <span class="zen-variable">$skills</span>:
  - Load <span class="zen-variable">$skill</span> source
  - <span class="zen-keyword">USE</span> <span class="zen-reference">~/skill/orchestrate</span> <span class="zen-keyword">TO</span> <span class="zen-semantic">/coordinate execution/</span>
  - Collect results</code></pre>

  <h2>Link Handling</h2>

  <p>
    By default, links stay as-is—the LLM interprets <code>~/skill/name</code>
    syntax directly. With optional preprocessing:
  </p>

  <ul>
    <li>
      <strong>Inlining</strong> — Referenced skill content embedded inline
    </li>
    <li>
      <strong>Section extraction</strong> — Only the referenced section included
    </li>
  </ul>

  <p>
    Both approaches are valid. Inlining reduces LLM load-time; leaving
    links keeps the prompt concise. Experiment to find what works best for
    your use case.
  </p>

  <h2>Best Practices</h2>

  <ul>
    <li>Use consistent folder organization (<code>agent/</code>, <code>skill/</code>, <code>tool/</code>)</li>
    <li>Create reusable prompt sections within skills</li>
    <li>Use descriptive section names</li>
    <li>Keep skills focused and composable</li>
    <li>Document expected parameters in Input sections</li>
  </ul>
</DocsLayout>
